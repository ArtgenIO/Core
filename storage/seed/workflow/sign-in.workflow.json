{
  "id": "51c0abf2-5924-4fdf-a920-a1b3487f6710",
  "name": "Authentication - Sign In",
  "nodes": [
    {
      "id": "trigger.http.1",
      "type": "trigger.http",
      "config": {
        "path": "/api/authentication/jwt/sign-in",
        "method": "POST",
        "statusCode": "200",
        "authentication": "public",
        "responseFormat": "application/json",
        "response": "{\"ack\":true}",
        "waitForLastNode": "true"
      },
      "label": "HTTP Endpoint",
      "position": [
        88.66666666666666,
        203.33333333333334
      ]
    },
    {
      "id": "rest.find.1",
      "type": "rest.find",
      "config": {
        "database": "system",
        "fields": [
          "id",
          "password"
        ],
        "schema": "Account"
      },
      "label": "Find Account",
      "position": [
        250.66666666666663,
        203.08333333333337
      ]
    },
    {
      "id": "if.1",
      "type": "if",
      "config": {
        "operator": "==",
        "against": true,
        "negate": false
      },
      "label": "If Found",
      "position": [
        547.4166666666666,
        88.89583333333337
      ]
    },
    {
      "id": "length.1",
      "type": "length",
      "config": null,
      "label": "Count",
      "position": [
        394.91666666666663,
        92.95833333333337
      ]
    },
    {
      "id": "terminate.http.2",
      "type": "terminate.http",
      "config": {
        "statusCode": "200"
      },
      "label": "Success",
      "position": [
        1071.4166666666665,
        -71.64358877512277
      ]
    },
    {
      "id": "terminate.http.1",
      "type": "terminate.http",
      "config": {
        "transform": "{\"success\": false, \"message\": \"Authentication failed\"}",
        "statusCode": "400"
      },
      "label": "Fail",
      "position": [
        885.1666666666666,
        328.08333333333337
      ]
    },
    {
      "id": "hash.compare.1",
      "type": "hash.compare",
      "config": null,
      "label": "CHK Passwd",
      "position": [
        722.2326274056248,
        17.129489116421098
      ]
    },
    {
      "id": "token.sign.1",
      "type": "token.sign",
      "config": {
        "expiresIn": "8h"
      },
      "label": "Sign JWT",
      "position": [
        897.1467175777061,
        -71.80098784951204
      ]
    }
  ],
  "edges": [
    {
      "id": "0d418dc4-8339-4d54-9dab-6911ca84c164",
      "sourceNodeId": "trigger.http.1",
      "targetNodeId": "rest.find.1",
      "sourceHandle": "request",
      "targetHandle": "conditions",
      "transform": "{\"email\": \"{{ $data.body.email }}\"}"
    },
    {
      "id": "4086f863-9be2-40ed-a3ae-5054581d278b",
      "sourceNodeId": "rest.find.1",
      "targetNodeId": "length.1",
      "sourceHandle": "records",
      "targetHandle": "subject",
      "transform": ""
    },
    {
      "id": "33c08b27-fc56-4e1d-9c78-9ccffb629dfc",
      "sourceNodeId": "length.1",
      "targetNodeId": "if.1",
      "sourceHandle": "length",
      "targetHandle": "subject",
      "transform": ""
    },
    {
      "id": "2a9a88d7-d876-4e53-82ed-c6c54cd0a79f",
      "sourceNodeId": "rest.find.1",
      "targetNodeId": "terminate.http.1",
      "sourceHandle": "error",
      "targetHandle": "response",
      "transform": ""
    },
    {
      "id": "12690074-0cac-4f33-ba78-a84b5a12c2a5",
      "sourceNodeId": "if.1",
      "targetNodeId": "terminate.http.1",
      "sourceHandle": "no",
      "targetHandle": "response",
      "transform": ""
    },
    {
      "id": "6c369397-bf96-4ee4-8b81-7966823f0fb0",
      "sourceNodeId": "if.1",
      "targetNodeId": "hash.compare.1",
      "sourceHandle": "yes",
      "targetHandle": "elements",
      "transform": "{\"hash\": \"{{ $nodes['rest.find.1'].output.records[0].password  }}\", \"plain\": \"{{ $trigger.body.password }}\"}"
    },
    {
      "id": "27d6ee54-058e-4549-b7b9-41d9285e4dd1",
      "sourceNodeId": "hash.compare.1",
      "targetNodeId": "terminate.http.1",
      "sourceHandle": "no",
      "targetHandle": "response",
      "transform": ""
    },
    {
      "id": "82ba84f4-5f2c-4c53-b358-53ebfc37ac35",
      "sourceNodeId": "hash.compare.1",
      "targetNodeId": "token.sign.1",
      "sourceHandle": "yes",
      "targetHandle": "accountId",
      "transform": "{{ $nodes['rest.find.1'].output.records[0].id }}"
    },
    {
      "id": "3729c621-6181-4ee8-9962-afd890d9cf2a",
      "sourceNodeId": "token.sign.1",
      "targetNodeId": "terminate.http.2",
      "sourceHandle": "token",
      "targetHandle": "response",
      "transform": "{\"accessToken\": \"{{ $output.token }}\"}"
    }
  ]
}